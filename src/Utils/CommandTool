<?php

namespace ZhenMu\Support\Utils;

class CommandTool
{
    protected $executableFinder;

    protected $defaultExtraDirs = [
        '/usr/bin/',
        '/usr/local/bin/',
    ];

    public function __construct()
    {
        $this->executableFinder = new \Symfony\Component\Process\ExecutableFinder();
    }

    public static function make()
    {
        return new static();
    }

    public function createProcess(array $command, string $cwd = null, array $env = null, $input = null, ?float $timeout = 60)
    {
        return tap(new \Symfony\Component\Process\Process(...func_get_args()));
    }
    
    public function findBinary(string $name, array $extraDirs = [])
    {
        return $this->executableFinder->find($name, false, $this->defaultExtraDirs + $extraDirs);
    }

    public static function getPhpProcess(array $argument)
    {
        $instance = new static();
        
        $php = $instance->findBinary('php');

        return $instance->createProcess([$php, ...$argument]);
    }

    public static function getComposerProcess(array $argument)
    {
        $instance = new static();
        
        $php = $instance->findBinary('php');

        $composer = $instance->findBinary('composer');

        return $instance->createProcess([$php, $composer, ...$argument]);
    }
}
